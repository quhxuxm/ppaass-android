package com.ppaass.agent.android;

import com.ppaass.agent.android.io.protocol.IpPacketReader;
import com.ppaass.agent.android.io.protocol.IpPacketWriter;
import com.ppaass.agent.android.io.protocol.ip.IpPacket;
import org.junit.Test;

import java.util.Arrays;

/**
 * Example local unit test, which will execute on the development machine (host).
 *
 * @see <a href="http://d.android.com/tools/testing">Testing documentation</a>
 */
public class ProtocolTest {
    @Test
    public void testReader() {
        short[] ipData = new short[]{
                0x45, 0x00, 0x00, 0x73, 0x05, 0x00, 0x40, 0x00, 0x80, 0x06, 0xd6, 0x27, 0x0a, 0xaf, 0x05, 0x24, 0x0a,
                0xaf, 0x04, 0xdc, 0x12, 0xff, 0x1e, 0x00, 0xbf, 0xae, 0xf2, 0xa4, 0x48, 0x22, 0x5f, 0xa7, 0x50, 0x18
                , 0x04, 0x02, 0x08, 0x41, 0x00, 0x00, 0x0e, 0x53, 0x77, 0x61, 0x72, 0x6d, 0x20, 0x70, 0x72, 0x6f
                , 0x74, 0x6f, 0x63, 0x6f, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x1b, 0x88, 0xa8
                , 0xf5, 0x05, 0x56, 0x96, 0x21, 0x4b, 0x65, 0xac, 0x08, 0xc4, 0x38, 0x01, 0x68, 0x0e, 0x9f, 0xdc
                , 0x9d, 0xc8, 0xf3, 0x5a, 0x89, 0x7f, 0xc4, 0x19, 0xc4, 0xc0, 0x3e, 0x4d, 0x5a, 0xae, 0x3c, 0xdd
                , 0x07, 0x78, 0x59, 0x81, 0x4b, 0xbe, 0xe7, 0x4d, 0x6e, 0xfb, 0x4b, 0x84, 0xae, 0x00, 0x00, 0x00
                , 0x00
        };
        byte[] ipDataByteArray = new byte[ipData.length];
        for (int i = 0; i < ipData.length; i++) {
            ipDataByteArray[i] = (byte) ipData[i];
        }
        IpPacket ipPacket = IpPacketReader.INSTANCE.parse(ipDataByteArray);
        System.out.println(ipPacket);
        System.out.println("======================================");
        byte[] ipPacketArray = IpPacketWriter.INSTANCE.write(ipPacket);
        short[] ipPacketArrayInShort = new short[ipPacketArray.length];
        for (int i = 0; i < ipPacketArray.length; i++) {
            ipPacketArrayInShort[i] = (short) (ipPacketArray[i] & 0xFF);
        }
        String[] hexArray = new String[ipPacketArrayInShort.length];
        for (int i = 0; i < ipPacketArrayInShort.length; i++) {
            hexArray[i] = Integer.toHexString(ipPacketArrayInShort[i]);
        }
        System.out.println(Arrays.toString(hexArray));
    }
}
